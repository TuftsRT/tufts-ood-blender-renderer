<%
  
  if (OodSupport::User.new.groups.map(&:name) & ['hpctools', 'blender' ]).any?
    gpu_options = [1, 2, 4]
    max_slots = 6
    mem_options = [2,4,8,16,32,64,128]
  else
    gpu_options = [1, 2]
    max_slots = 1
    mem_options =  [2,4,8,16,32]
  end

%>

---
cluster: "pax"

attributes:
  bc_num_hours:
    value: "2" 

  num_cores:
    widget: "select"
    label: "Cores"
    options:
      - ["2", "2"]
      - ["4", "4"]
      - ["8", "8"]
      - ["12", "12"]
    value: "8"

  num_memory:
    widget: "select"
    label: "Memory (GB)"
    options:
<% mem_options.each do |n| %>
    - ["<%= n %>", "<%= n %>"]
<% end %>  
    value: "16"

  partition:
    widget: "select"
    label: "Partition"
    help: "NOTE: jobs submitted to the preempt partition may get automatically killed to allow higher priority jobs to run"
    options:
      - ["gpu"]
      - ["preempt"]
    value: "gpu"

  gpu_type:
    widget: "select"
    label: "GPU type"
    help: "Not all GPU types are available in all partitions."
    options:
      - ["A100 - 40GB", "a100"]
      - ["A100 - 80GB", "a100-80GB"]
      - ["L40S - 48GB", "l40s"]
    value: "l40s"

  gpu_count:
    widget: "select"
    label: "GPU Count"
    help: "Number of GPUs per node to use for this render job."
    options:
<% gpu_options.each do |n| %>
    - ["<%= n %>", "<%= n %>"]
<% end %>
    value: "1"

  bc_num_slots:
    min: 1
    max: <%=max_slots %>



  projectfile:
    label: Blender Project File
    widget: path_selector
    directory: /cluster/tufts
    favorites:
      - /cluster/tufts
      - /cluster/home

  outputdir:
    label: "Render output directory"
    widget: path_selector
    directory: /cluster/home
    show_files: false
    help: "Specifies the output directory for storing your rendered frames. If left unset, it defaults to a output folder next to your selected project file."
    favorites:
      - /cluster/tufts
      - /cluster/home

  start_frame:
    label: "Start at frame number"
    help: "Enter the number of the frame to start at.  First frame is 1."
    value: "1"
    min: 1

  end_frame:
    label: "End at frame number"
    help: "Enter the number of the frame to end at.  Level blank to render to the last frame."
    value: ""

form:
  - bc_num_hours
  - num_cores
  - num_memory
  - partition
  - gpu_type 
  - gpu_count
  - bc_num_slots
  - projectfile
  - outputdir
  - start_frame
  - end_frame
